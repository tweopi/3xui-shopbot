{% extends "base.html" %} {% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–æ—Ç–∞ –∏ –•–æ—Å—Ç–æ–≤{% endblock %}
{% block content %}

<div class="page-header d-print-none">
  <div class="row align-items-center">
    <div class="col">
      <h2 class="page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <div class="text-secondary">–ü–∞–Ω–µ–ª—å, –±–æ—Ç—ã, –ø–ª–∞—Ç–µ–∂–∏, —Ö–æ—Å—Ç—ã –∏ –∫–æ–Ω—Ç–µ–Ω—Ç</div>
    </div>
  </div>
  <div class="hr-text"></div>
</div>

{# –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∑–∞–ø—É—Å–∫—É #}
{% if all_settings_ok and support_settings_ok %}
  <div class="alert alert-success" role="alert">
    ‚úÖ –í–µ–±‚Äë–ø–∞–Ω–µ–ª—å –∏ –æ–±–∞ –±–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å.
  </div>
{% else %}
  <div class="alert alert-warning" role="alert">
    ‚ö†Ô∏è –ó–∞–ø—É—Å–∫ –±–æ—Ç–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.
    <div class="small text-secondary mt-1">
      –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç: {{ '–æ–∫' if all_settings_ok else '–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫' }} ‚Ä¢ Support‚Äë–±–æ—Ç: {{ '–æ–∫' if support_settings_ok else '–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫' }}
    </div>
  </div>
{% endif %}

{# –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ #}
<div class="card glass mb-3">
  <div class="card-body py-2">
    <ul class="nav nav-pills">
      <li class="nav-item"><a class="nav-link" href="#panel">–ü–∞–Ω–µ–ª—å</a></li>
      <li class="nav-item"><a class="nav-link" href="#bot">–ë–æ—Ç</a></li>
      <li class="nav-item"><a class="nav-link" href="#support-bot">Support‚Äë–±–æ—Ç</a></li>
      <li class="nav-item"><a class="nav-link" href="#payments">–ü–ª–∞—Ç–µ–∂–∏</a></li>
      <li class="nav-item"><a class="nav-link" href="#hosts">–•–æ—Å—Ç—ã/–¢–∞—Ä–∏—Ñ—ã</a></li>
      <li class="nav-item"><a class="nav-link" href="#referrals">–†–µ—Ñ–µ—Ä–∞–ª—ã</a></li>
      <li class="nav-item"><a class="nav-link" href="#trial">–¢—Ä–∏–∞–ª</a></li>
      <li class="nav-item"><a class="nav-link" href="#content">–ö–æ–Ω—Ç–µ–Ω—Ç</a></li>
    </ul>
  </div>
  </div>

<style>
  /* Inline edit collapse animation */
  .collapse { max-height: 0; overflow: hidden; opacity: 0; transition: max-height 220ms ease, opacity 220ms ease; }
  .collapse.show { opacity: 1; }
  .plan-row { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
  .plan-label { margin-right: 4px; min-width: 200px; }
  .plan-edit form { display: inline-flex; gap: 6px; align-items: center; padding-top: 6px; }
  .button-secondary { background: #f0f0f0; color: #333; border: 1px solid #ddd; }
  .button-secondary:hover { background: #e9e9e9; }
  .plan-edit-toggle[aria-expanded="true"] { transform: rotate(0deg); }
  .plan-edit-toggle { transition: transform 180ms ease; }

  /* Soft-select –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ static/css/style.css */
  .soft-select select { position: absolute; inset: 0; opacity: 0; pointer-events: none; }
  /* –ë–µ–π–¥–∂ –¥–∞—Ç—ã –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ª–∏–Ω–∏–π */
  #backup-date.badge { border: 0; }
  /* –ù–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –ø–æ–¥ —Å–µ–ª–µ–∫—Ç–æ–º –Ω–∞ —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
  @media (max-width: 767.98px){
    #backup-date.badge { margin-top: 6px; }
  }

  /* –ü—Ä–∞–≤–∫–∏ –¥–ª—è "–ª–∏–Ω–∏–π" –≤ –±–ª–æ–∫–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ */
  #btn-pick-file.btn,
  #picked-file-name.form-control {
    border-color: rgba(255,255,255,.14) !important;
    box-shadow: none !important;
    background: rgba(17,20,28,.45) !important;
    color: inherit;
  }
  /* –ï–¥–∏–Ω–∞—è "–ø–∏–ª—é–ª—è": —Å–∫—Ä—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ */
  #btn-pick-file.btn { border-right-width: 0 !important; }
  #picked-file-name.form-control { border-left-width: 0 !important; }
  /* –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–ª—å–Ω—ã–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫—Ä–∞—è—Ö */
  .input-group > .btn.pill.rounded-start { border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; }
  .input-group > .form-control.pill.rounded-end { border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; }
  /* –ù–∞–≤–µ–¥–µ–Ω–∏–µ/—Ñ–æ–∫—É—Å –±–µ–∑ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —à–≤–æ–≤ */
  #btn-pick-file.btn:hover,
  #btn-pick-file.btn:focus,
  #picked-file-name.form-control:focus {
    background: rgba(17,20,28,.52) !important;
    border-color: rgba(255,255,255,.18) !important;
    box-shadow: none !important;
  }
</style>

<div class="settings-container">
	<div class="settings-column-left">
		<section class="settings-section" id="hosts">
			<h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –•–æ—Å—Ç–∞–º–∏ (–°–µ—Ä–≤–µ—Ä–∞–º–∏)</h2>

			<div class="row g-3 align-items-start">
				<div class="col-12 col-lg-5">
					<div class="host-card">
						<h4>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ö–æ—Å—Ç</h4>
						<form action="{{ url_for('add_host_route') }}" method="post">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
							<div class="form-group">
								<label for="host_name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞:</label>
								<input type="text" id="host_name" name="host_name" required />
							</div>
							<div class="form-group">
								<label for="host_url">URL –ø–∞–Ω–µ–ª–∏ XUI:</label>
								<input type="url" id="host_url" name="host_url" placeholder="http://123.45.67.89:54321" required />
							</div>
							<div class="form-group">
								<label for="host_username">–õ–æ–≥–∏–Ω XUI:</label>
								<input type="text" id="host_username" name="host_username" required />
							</div>
							<div class="form-group password-wrapper">
								<label for="host_pass">–ü–∞—Ä–æ–ª—å XUI:</label>
								<input type="password" id="host_pass" name="host_pass" required />
								<button type="button" class="toggle-password">üëÅÔ∏è</button>
							</div>
							<div class="form-group">
								<label for="host_inbound_id">ID –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</label>
								<input type="number" id="host_inbound_id" name="host_inbound_id" required />
							</div>
							<div class="form-group">
								<label for="host_subscription_url">–°—Å—ã–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Ö–æ—Å—Ç–∞ (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
								<input type="text" id="host_subscription_url" name="host_subscription_url" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, https://sub.example.com/{token}" />
								<small>–£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è —ç—Ç–æ–≥–æ —Ö–æ—Å—Ç–∞.</small>
							</div>
							<button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
						</form>
					</div>
				</div>
				<div class="col-12 col-lg-7">
					{% if hosts %}
						{% for host in hosts %}
						<div class="host-card">
				<div class="host-header">
					<h3>{{ host.host_name }}</h3>
					<form
						action="{{ url_for('delete_host_route', host_name=host.host_name) }}"
						method="post"
						data-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ö–æ—Å—Ç –∏ –≤—Å–µ –µ–≥–æ —Ç–∞—Ä–∏—Ñ—ã?"
					>
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
						<button type="submit" class="btn btn-danger btn-sm">
							–£–¥–∞–ª–∏—Ç—å
						</button>
					</form>
				</div>
				<!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ URL –ø–∞–Ω–µ–ª–∏ XUI -->
				<form action="{{ url_for('update_host_url_route') }}" method="post" class="form-inline edit-row" data-edit-row>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
					<input type="hidden" name="host_name" value="{{ host.host_name }}" />
					<label class="form-label" for="host_url_{{ loop.index }}">URL –ø–∞–Ω–µ–ª–∏ XUI:</label>
					<input id="host_url_{{ loop.index }}" class="form-control pill" type="text" name="host_url" value="{{ host.host_url or '' }}" data-edit-target readonly />
					<div class="edit-actions">
						<button type="button" class="btn btn-outline-secondary btn-sm pill" data-action="edit">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
						<button type="submit" class="btn btn-primary btn-sm pill d-none" data-action="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
						<button type="button" class="btn btn-outline-secondary btn-sm pill d-none" data-action="cancel">–û—Ç–º–µ–Ω–∞</button>
					</div>
				</form>

				<!-- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞ -->
				<form action="{{ url_for('rename_host_route') }}" method="post" class="form-inline edit-row" data-edit-row>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
					<input type="hidden" name="old_host_name" value="{{ host.host_name }}" />
					<label class="form-label" for="new_host_name_{{ loop.index }}">–ò–º—è —Ö–æ—Å—Ç–∞:</label>
					<input id="new_host_name_{{ loop.index }}" class="form-control pill" type="text" name="new_host_name" value="{{ host.host_name or '' }}" data-edit-target readonly />
					<div class="edit-actions">
						<button type="button" class="btn btn-outline-secondary btn-sm pill" data-action="edit">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
						<button type="submit" class="btn btn-primary btn-sm pill d-none" data-action="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
						<button type="button" class="btn btn-outline-secondary btn-sm pill d-none" data-action="cancel">–û—Ç–º–µ–Ω–∞</button>
					</div>
				</form>
				<form action="{{ url_for('update_host_subscription_route') }}" method="post" class="form-inline" style="margin: 8px 0;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
					<input type="hidden" name="host_name" value="{{ host.host_name }}" />
					<input class="form-control pill" type="text" name="host_subscription_url" placeholder="–°—Å—ã–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Ö–æ—Å—Ç–∞" value="{{ host.subscription_url or '' }}" />
					<button type="submit" class="btn btn-outline-secondary btn-sm pill" style="margin-left:6px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
				</form>
                <!-- SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è speedtest –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ -->
                <div class="card glass" style="margin: 8px 0;">
                  <div class="card-body">
                    <h4 class="card-title" style="margin-bottom:8px;">SSH –¥–ª—è Speedtest</h4>
                    <form action="{{ url_for('update_host_ssh_route') }}" method="post" class="form-inline">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                      <input type="hidden" name="host_name" value="{{ host.host_name }}" />
                      <div class="row g-2 align-items-end">
                        <div class="col-12 col-md-3">
                          <label class="form-label" for="ssh_host_{{ loop.index }}">SSH Host</label>
                          <input id="ssh_host_{{ loop.index }}" type="text" class="form-control pill" name="ssh_host" value="{{ host.ssh_host or '' }}" placeholder="example.com –∏–ª–∏ 1.2.3.4" />
                        </div>
                        <div class="col-6 col-md-2">
                          <label class="form-label" for="ssh_port_{{ loop.index }}">Port</label>
                          <input id="ssh_port_{{ loop.index }}" type="number" class="form-control pill" name="ssh_port" value="{{ host.ssh_port or '' }}" placeholder="22" />
                        </div>
                        <div class="col-6 col-md-2">
                          <label class="form-label" for="ssh_user_{{ loop.index }}">User</label>
                          <input id="ssh_user_{{ loop.index }}" type="text" class="form-control pill" name="ssh_user" value="{{ host.ssh_user or '' }}" placeholder="root" />
                        </div>
                        <div class="col-12 col-md-5">
                          <label class="form-label" for="ssh_password_{{ loop.index }}">–ü–∞—Ä–æ–ª—å (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –ø—Ä–∏ –∫–ª—é—á–µ)</label>
                          <input id="ssh_password_{{ loop.index }}" type="password" class="form-control pill" name="ssh_password" value="{{ host.ssh_password or '' }}" />
                        </div>
                        <div class="col-12 col-md-7">
                          <label class="form-label" for="ssh_key_path_{{ loop.index }}">–ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–∞–Ω–µ–ª–∏)</label>
                          <input id="ssh_key_path_{{ loop.index }}" type="text" class="form-control pill" name="ssh_key_path" value="{{ host.ssh_key_path or '' }}" placeholder="/app/keys/id_rsa" />
                        </div>
                        <div class="col-12 col-md-5 d-flex align-items-end">
                          <button type="submit" class="btn btn-primary btn-sm pill">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å SSH</button>
                          <button type="submit"
                                  class="btn btn-outline-secondary btn-sm pill"
                                  style="margin-left:8px;"
                                  title="–ê–≤—Ç–æ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ speedtest-–∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç–µ –ø–æ SSH"
                                  formaction="{{ url_for('auto_install_speedtest_route', host_name=host.host_name) }}">
                            –ê–≤—Ç–æ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Speedtest
                          </button>
                        </div>
                        <div class="col-12">
                          <small class="text-secondary">–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∫–ª—é—á ‚Äî –ø–∞—Ä–æ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.</small>
                        </div>
                      </div>
                    </form>
                    <!-- –ë–ª–æ–∫ —Ç–µ—Å—Ç–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –Ω–∞ –ì–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É -->
                  </div>
                </div>
				<div class="plans-section">
					<h4>–¢–∞—Ä–∏—Ñ—ã:</h4>
					{% if host.plans %}
					<ul class="plan-list">
						{% for plan in host.plans %}
						<li>
							<div class="plan-row">
								<span class="plan-label">{{ plan.plan_name }} ‚Äî {{ plan.months }} –º–µ—Å ‚Äî {{ plan.price|round(0) }} RUB</span>
								<button type="button" class="btn btn-outline-secondary btn-sm pill plan-edit-toggle" data-target="#edit-{{ plan.plan_id }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
								<form
									action="{{ url_for('delete_plan_route', plan_id=plan.plan_id) }}"
									method="post"
									style="display:inline-block;"
									data-confirm="–£–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ '{{ plan.plan_name }}'?"
								>
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
									<button type="submit" class="btn btn-danger btn-sm" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
								</form>
							</div>
							<div id="edit-{{ plan.plan_id }}" class="plan-edit collapse">
								<form action="{{ url_for('update_plan_route', plan_id=plan.plan_id) }}" method="post" class="form-inline">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
									<input type="text" class="form-control pill" name="plan_name" value="{{ plan.plan_name }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required style="min-width:140px;" />
									<input type="number" class="form-control pill" name="months" value="{{ plan.months }}" placeholder="–ú–µ—Å." required style="width:80px;" />
									<input type="number" step="0.01" class="form-control pill" name="price" value="{{ plan.price }}" placeholder="–¶–µ–Ω–∞" required style="width:110px;" />
									<button type="submit" class="btn btn-primary btn-sm pill">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
								</form>
							</div>
						</li>
						{% endfor %}
					</ul>
					{% else %}
					<p>–¢–∞—Ä–∏—Ñ—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
					{% endif %}
					<h5>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ:</h5>
					<form
						action="{{ url_for('add_plan_route') }}"
						method="post"
						class="form-inline"
					>
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
						<input
							type="hidden"
							name="host_name"
							value="{{ host.host_name }}"
						/>
						<input
							type="text"
							class="form-control pill"
							name="plan_name"
							placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"
							required
						/>
						<input type="number" class="form-control pill" name="months" placeholder="–ú–µ—Å." required />
						<input
							type="number"
							step="0.01"
							class="form-control pill"
							name="price"
							placeholder="–¶–µ–Ω–∞"
							required
						/>
						<button type="submit" class="btn btn-primary btn-sm pill">
							+
						</button>
					</form>
				</div>
						</div>
						{% endfor %}
					{% else %}
						<p>–•–æ—Å—Ç—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
					{% endif %}
				</div>
			</div>
		</section>
	</div>

	<div class="settings-column-right">
        <form action="{{ url_for('settings_page') }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="next_hash" id="settings-next-hash" value="#panel" />
			<section class="settings-section" id="panel">
				<div class="card">
					<div class="card-header"><h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–∞–Ω–µ–ª–∏</h2></div>
					<div class="card-body">
						<div class="form-group">
							<label for="panel_login">–õ–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ø–∞–Ω–µ–ª—å:</label>
							<input
								type="text"
								id="panel_login"
								name="panel_login"
								value="{{ settings.panel_login or '' }}"
								required
							/>
						</div>
						<div class="form-group password-wrapper">
							<label for="panel_password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å):</label>
							<input type="password" id="panel_password" name="panel_password" />
							<button type="button" class="toggle-password">üëÅÔ∏è</button>
						</div>
						<div class="mb-3">
                            <label class="form-label" for="backup_interval_days">–ê–≤—Ç–æ–±—ç–∫–∞–ø –±–∞–∑—ã (–∫–∞–∂–¥—ã–µ N –¥–Ω–µ–π)</label>
                            <input class="form-control pill-md" type="number" min="0" step="1" id="backup_interval_days" name="backup_interval_days" value="{{ settings.backup_interval_days or '1' }}" placeholder="1" />
                            <div class="form-text">0 ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–±—ç–∫–∞–ø. –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∞—Ä—Ö–∏–≤ –ë–î –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ /app/project/backups.</div>
                        </div>

                        <div class="mb-3">
                          <div class="row g-2 align-items-start">
                            <div class="col-12 col-md-5">
                              <label class="form-label">–ë—ç–∫–∞–ø –±–∞–∑—ã</label>
                              <div class="d-grid">
                              <button type="submit"
                                      class="btn btn-outline-primary w-100"
                                      formmethod="post"
                                      formaction="{{ url_for('backup_db_route') }}"
                                      title="–°–∫–∞—á–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∞—Ä—Ö–∏–≤ –ë–î">
                                <i class="ti ti-database-export me-1"></i>
                                –°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø –ë–î
                              </button>
                              </div>
                            </div>
                            <div class="col-12 col-md-7">
                              <label class="form-label" for="existing_backup">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –±—ç–∫–∞–ø</label>
                              <div class="row g-2 align-items-center">
                                <div class="col-12">
                                  <div class="d-flex align-items-center gap-2 w-100">
                                    <div class="soft-select flex-grow-1" data-target="existing_backup" style="min-width:0;">
                                      <button type="button" class="soft-select-toggle pill" id="existing_backup_toggle">‚Äî</button>
                                      <div class="soft-select-menu" id="existing_backup_menu"></div>
                                      <select class="form-select pill" id="existing_backup" name="existing_backup">
                                        <option value="" selected>‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä—Ö–∏–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ ‚Äî</option>
                                        {% for b in backups %}
                                          <option value="{{ b.name }}" data-mtime="{{ b.mtime }}">{{ b.name }}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
                                    <span class="badge bg-secondary-lt rounded-pill px-3" id="backup-date" title="–î–∞—Ç–∞ –∞—Ä—Ö–∏–≤–∞">‚Äî</span>
                                  </div>
                                  <div class="form-text text-secondary">–î–∞—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞.</div>
                                </div>
                              </div>

                              <div class="mt-2 small text-secondary">–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–π —Ñ–∞–π–ª (.zip –∏–ª–∏ .db)</div>
                              <div class="d-flex align-items-stretch gap-2">
                                <div class="input-group w-100 seamless">
                                  <button type="button" class="btn btn-outline-secondary pill rounded-start" id="btn-pick-file">
                                    <i class="ti ti-upload me-1"></i>
                                    –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                                  </button>
                                  <input type="text" class="form-control pill rounded-end" id="picked-file-name" value="–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω" readonly style="min-width:0;">
                                </div>
                                <button type="submit"
                                        class="btn btn-danger pill ms-2"
                                        formmethod="post"
                                        formaction="{{ url_for('restore_db_route') }}"
                                        formenctype="multipart/form-data"
                                        title="–¢–µ–∫—É—â–∞—è –ë–î –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞">
                                  <i class="ti ti-database-import me-1"></i>
                                  –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                </button>
                              </div>
                              <input class="d-none" type="file" id="db_file" name="db_file" accept=".zip,.db" />
                              <div class="form-text text-secondary">–ü–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∞—è –±–∞–∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ /app/project/backups.</div>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
            </section>

			<section class="settings-section" id="bot">
				<div class="card">
					<div class="card-header"><h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–æ—Ç–∞</h2></div>
					<div class="card-body">
						<div class="status-bar" style="margin-bottom: 10px;">
							<p><strong>–°—Ç–∞—Ç—É—Å:</strong>
								{% if support_bot_status and support_bot_status.is_running %}
									<span class="badge badge-success">–∑–∞–ø—É—â–µ–Ω</span>
								{% else %}
									<span class="badge badge-danger">–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
								{% endif %}
							</p>
						</div>
						<div class="form-group password-wrapper">
							<label for="telegram_bot_token">–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</label>
							<input
								type="password"
								id="telegram_bot_token"
								name="telegram_bot_token"
								value="{{ settings.telegram_bot_token or '' }}"
								required
							/>
							<button type="button" class="toggle-password">üëÅÔ∏è</button>
						</div>
						<div class="form-group">
							<label for="telegram_bot_username">Username –±–æ—Ç–∞ (–±–µ–∑ @):</label>
							<input
								type="text"
								id="telegram_bot_username"
								name="telegram_bot_username"
								value="{{ settings.telegram_bot_username or '' }}"
								required
							/>
						</div>
						<div class="form-group">
							<label for="admin_telegram_id">Telegram ID –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
							<input
								type="text"
								id="admin_telegram_id"
								name="admin_telegram_id"
								value="{{ settings.admin_telegram_id or '' }}"
								required
							/>
						</div>
					</div>
				</div>
			</section>
			<section class="settings-section" id="support-bot">
                <div class="card glass">
                    <div class="card-header"><h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Support-–±–æ—Ç–∞</h2></div>
                    <div class="card-body">
                        <div class="status-bar" style="margin-bottom: 10px;">
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                                {% if support_bot_status and support_bot_status.is_running %}
                                    <span class="badge badge-success">–∑–∞–ø—É—â–µ–Ω</span>
                                {% else %}
                                    <span class="badge badge-danger">–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="form-group password-wrapper">
                            <label for="support_bot_token">–¢–æ–∫–µ–Ω support-–±–æ—Ç–∞:</label>
                            <input type="password" id="support_bot_token" name="support_bot_token" value="{{ settings.support_bot_token or '' }}" required />
                            <button type="button" class="toggle-password">üëÅÔ∏è</button>
                        </div>
                        <div class="form-group">
                            <label for="support_bot_username">Username support-–±–æ—Ç–∞ (–±–µ–∑ @):</label>
                            <input type="text" id="support_bot_username" name="support_bot_username" value="{{ settings.support_bot_username or '' }}" />
                        </div>
                        <div class="form-group">
                            <label for="support_forum_chat_id">ID —Å–∞–ø–ø–æ—Ä—Ç-—á–∞—Ç–∞ (forum chat id):</label>
                            <input type="text" id="support_forum_chat_id" name="support_forum_chat_id" value="{{ settings.support_forum_chat_id or '' }}" class="form-control pill" />
                            <small class="text-secondary">–£–∫–∞–∂–∏—Ç–µ ID forum-—á–∞—Ç–∞, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤—ã–≤–æ–¥ —Ç–∏–∫–µ—Ç–æ–≤ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.</small>
                        </div>
                    </div>
                </div>
            </section>
            			<section class="settings-section" id="referrals">
				<div class="card">
					<div class="card-header"><h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2></div>
					<div class="card-body">
						<div class="mb-3">
							<input type="hidden" name="enable_referrals" value="false" />
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="enable_referrals" name="enable_referrals" value="true" {% if settings.enable_referrals == 'true' %}checked{% endif %}>
								<label class="form-check-label" for="enable_referrals">–í–∫–ª—é—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É</label>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label" for="referral_reward_type">–¢–∏–ø –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</label>
							<div class="input-group with-prefix">
                                <span class="input-group-text"><i class="ti ti-gift"></i></span>
                                <div class="soft-select flex-grow-1" data-target="referral_reward_type">
                                    <button type="button" class="soft-select-toggle" id="referral_reward_type_toggle">‚Äî</button>
                                    <div class="soft-select-menu" id="referral_reward_type_menu"></div>
                                    <select class="form-select rounded-3 select-soft" id="referral_reward_type" name="referral_reward_type">
                                        <option value="percent_purchase" {% if (settings.referral_reward_type or 'percent_purchase') == 'percent_purchase' %}selected{% endif %}>–ü—Ä–æ—Ü–µ–Ω—Ç —Å –ø–æ–∫—É–ø–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞</option>
                                        <option value="fixed_purchase" {% if settings.referral_reward_type == 'fixed_purchase' %}selected{% endif %}>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ –∑–∞ –ø–æ–∫—É–ø–∫—É —Ä–µ—Ñ–µ—Ä–∞–ª–∞</option>
                                        <option value="fixed_start_referrer" {% if settings.referral_reward_type == 'fixed_start_referrer' %}selected{% endif %}>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ–Ω—É—Å –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ</option>
                                    </select>
                                </div>
                            </div>
							<div class="form-text text-secondary">–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞.</div>
						</div>
						<div class="mb-3">
							<label class="form-label" for="minimum_withdrawal">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞</label>
							<input class="form-control pill-md" type="number" id="minimum_withdrawal" name="minimum_withdrawal" value="{{ settings.minimum_withdrawal or '10' }}" />
						</div>

						<!-- Percent mode -->
						<div class="mb-3" data-ref-section="percent_purchase">
							<label class="form-label" for="referral_percentage">–ü—Ä–æ—Ü–µ–Ω—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É</label>
							<div class="input-group with-suffix">
                                <input class="form-control pill-md" type="number" id="referral_percentage" name="referral_percentage" value="{{ settings.referral_percentage or '10' }}" />
                                <span class="input-group-text">%</span>
                            </div>
							<div class="form-text text-secondary">–ù–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É –æ—Ç —Å—É–º–º—ã –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ.</div>
						</div>
						<!-- Fixed per purchase mode -->
						<div class="mb-3" data-ref-section="fixed_purchase">
							<label class="form-label" for="fixed_referral_bonus_amount">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ –∑–∞ –ø–æ–∫—É–ø–∫—É</label>
							<div class="input-group with-suffix">
                                <input class="form-control pill-md" type="number" step="0.01" id="fixed_referral_bonus_amount" name="fixed_referral_bonus_amount" value="{{ settings.fixed_referral_bonus_amount or '50' }}" />
                                <span class="input-group-text">‚ÇΩ</span>
                            </div>
                            <div class="form-text text-secondary">–ö–∞–∂–¥–∞—è –ø–æ–∫—É–ø–∫–∞ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ –Ω–∞—á–∏—Å–ª—è–µ—Ç —Ä–µ—Ñ–µ—Ä–µ—Ä—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—É–º–º—É.</div>
                        </div>

                        <!-- Fixed start bonus to referrer on start mode -->
                        <div class="mb-3" data-ref-section="fixed_start_referrer">
                            <label class="form-label" for="referral_on_start_referrer_amount">–ë–æ–Ω—É—Å –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (RUB)</label>
                            <div class="input-group with-suffix">
                                <input class="form-control pill-md" type="number" step="0.01" id="referral_on_start_referrer_amount" name="referral_on_start_referrer_amount" value="{{ settings.referral_on_start_referrer_amount or '20' }}" />
                                <span class="input-group-text">‚ÇΩ</span>
                            </div>
                            <div class="form-text text-secondary">–ï–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–æ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É, –∫–æ–≥–¥–∞ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –ø–æ –µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ.</div>
                        </div>

						<!-- Backward compatibility hidden flag (not shown) -->
						<input type="hidden" id="enable_fixed_referral_bonus" name="enable_fixed_referral_bonus" value="{% if settings.enable_fixed_referral_bonus == 'true' %}true{% else %}false{% endif %}" />

						<div class="mb-3">
							<label class="form-label" for="referral_discount">–°–∫–∏–¥–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É (%)</label>
							<input class="form-control pill-md" type="number" id="referral_discount" name="referral_discount" value="{{ settings.referral_discount or '5' }}" />
						</div>
					</div>
				</div>
			</section>
			<section class="settings-section" id="trial">
				<div class="card">
					<div class="card-header"><h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</h2></div>
					<div class="card-body">
						<div class="mb-3">
							<input type="hidden" name="trial_enabled" value="false" />
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="trial_enabled" name="trial_enabled" value="true" {% if settings.trial_enabled == 'true' %}checked{% endif %}>
								<label class="form-check-label" for="trial_enabled">–í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥</label>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label" for="trial_duration_days">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–≤ –¥–Ω—è—Ö)</label>
							<input class="form-control" type="number" id="trial_duration_days" name="trial_duration_days" value="{{ settings.trial_duration_days or '3' }}" />
						</div>
					</div>
				</div>
			</section>

			<section class="settings-section" id="payments">
				<div class="card">
					<div class="card-header"><h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–ª–∞—Ç–µ–∂–Ω—ã—Ö –°–∏—Å—Ç–µ–º</h2></div>
					<div class="card-body">
						<h3 class="h4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooKassa</h3>
						<div class="mb-3">
							<label class="form-label" for="receipt_email">–ü–æ—á—Ç–∞ –¥–ª—è —á–µ–∫–æ–≤</label>
							<input class="form-control" type="text" id="receipt_email" name="receipt_email" value="{{ settings.receipt_email or '' }}" />
						</div>
						<div class="mb-3">
							<label class="form-label" for="yookassa_shop_id">YooKassa Shop ID</label>
							<input class="form-control" type="text" id="yookassa_shop_id" name="yookassa_shop_id" value="{{ settings.yookassa_shop_id or '' }}" />
						</div>
						<div class="mb-3 password-wrapper">
							<label class="form-label" for="yookassa_secret_key">YooKassa Secret Key</label>
							<div class="d-flex gap-2">
								<input class="form-control" type="password" id="yookassa_secret_key" name="yookassa_secret_key" value="{{ settings.yookassa_secret_key or '' }}" />
								<button type="button" class="btn btn-outline-secondary toggle-password">üëÅÔ∏è</button>
							</div>
						</div>
						<div class="mb-3">
							<input type="hidden" name="sbp_enabled" value="false" />
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="sbp_enabled" name="sbp_enabled" value="true" {% if settings.sbp_enabled == 'true' %}checked{% endif %}>
								<label class="form-check-label" for="sbp_enabled">–í–∫–ª—é—á–∏—Ç—å –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ –°–ë–ü</label>
							</div>
						</div>

						<h3 class="h4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CryptoBot</h3>
						<div class="mb-3 password-wrapper">
							<label class="form-label" for="cryptobot_token">CryptoBot Token</label>
							<div class="d-flex gap-2">
								<input class="form-control" type="password" id="cryptobot_token" name="cryptobot_token" value="{{ settings.cryptobot_token or '' }}" />
								<button type="button" class="btn btn-outline-secondary toggle-password">üëÅÔ∏è</button>
							</div>
						</div>

						<h3 class="h4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Heleket</h3>
						<div class="mb-3">
							<label class="form-label" for="heleket_merchant_id">Heleket Merchant ID</label>
							<input class="form-control" type="text" id="heleket_merchant_id" name="heleket_merchant_id" value="{{ settings.heleket_merchant_id or '' }}" />
						</div>
						<div class="mb-3 password-wrapper">
							<label class="form-label" for="heleket_api_key">Heleket API Key</label>
							<div class="d-flex gap-2">
								<input class="form-control" type="password" id="heleket_api_key" name="heleket_api_key" value="{{ settings.heleket_api_key or '' }}" />
								<button type="button" class="btn btn-outline-secondary toggle-password">üëÅÔ∏è</button>
							</div>
						</div>

						<div class="mb-3">
							<label class="form-label" for="domain">–í–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, my-shop.com)</label>
							<input class="form-control" type="text" id="domain" name="domain" value="{{ settings.domain or '' }}" />
						</div>

						<h3 class="h4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ TonConnect</h3>
						<div class="mb-3">
							<label class="form-label" for="ton_wallet_address">Ton Wallet</label>
							<input class="form-control" type="text" id="ton_wallet_address" name="ton_wallet_address" value="{{ settings.ton_wallet_address or '' }}" />
						</div>
						<div class="mb-3 password-wrapper">
							<label class="form-label" for="tonapi_key">TonAPI Key</label>
							<div class="d-flex gap-2">
								<input class="form-control" type="password" id="tonapi_key" name="tonapi_key" value="{{ settings.tonapi_key or '' }}" />
								<button type="button" class="btn btn-outline-secondary toggle-password">üëÅÔ∏è</button>
							</div>
						</div>
					</div>
				</div>
			</section>

			<section class="settings-section" id="content">
				<div class="card">
					<div class="card-header"><h2 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–æ–Ω—Ç–µ–Ω—Ç–∞</h2></div>
					<div class="card-body">
						<div class="mb-3">
							<label class="form-label" for="about_text">–¢–µ–∫—Å—Ç "–û –ø—Ä–æ–µ–∫—Ç–µ"</label>
							<textarea class="form-control" id="about_text" name="about_text" rows="3">{{ settings.about_text or "" }}</textarea>
						</div>
						<div class="mb-3">
							<label class="form-label" for="support_text">–¢–µ–∫—Å—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–¥–¥–µ—Ä–∂–∫–∞"</label>
							<textarea class="form-control" id="support_text" name="support_text" rows="3">{{ settings.support_text or "" }}</textarea>
						</div>
						<div class="mb-3">
							<label class="form-label" for="terms_url">URL "–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"</label>
							<input class="form-control" type="url" id="terms_url" name="terms_url" value="{{ settings.terms_url or '' }}" />
						</div>
						<div class="mb-3">
							<label class="form-label" for="privacy_url">URL "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏"</label>
							<input class="form-control" type="url" id="privacy_url" name="privacy_url" value="{{ settings.privacy_url or '' }}" />
						</div>
						<div class="mb-3">
							<label class="form-label" for="support_user">URL –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–Ω–∞–ø—Ä. https://t.me/T_Shift_Service)</label>
							<input class="form-control" type="text" id="support_user" name="support_user" value="{{ settings.support_user or '' }}" />
						</div>
						<div class="mb-3">
							<label class="form-label" for="channel_url">URL Telegram-–∫–∞–Ω–∞–ª–∞ (–Ω–∞–ø—Ä. https://t.me/tweopi)</label>
							<input class="form-control" type="url" id="channel_url" name="channel_url" value="{{ settings.channel_url or '' }}" />
						</div>
						<div class="mb-3">
							<input type="hidden" name="force_subscription" value="false" />
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="force_subscription" name="force_subscription" value="true" {% if settings.force_subscription == 'true' %}checked{% endif %}>
								<label class="form-check-label" for="force_subscription">–¢—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª</label>
							</div>
						</div>
					</div>
				</div>
			</section>

			<input type="hidden" id="settings-next-hash" name="next_hash" />
			<button type="submit" class="btn btn-primary">
				–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
			</button>
		        </form>
    </div>
</div>

<script>
  // –ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∑–∞–ø–æ–º–∏–Ω–∞–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
  (function(){
    const form = document.querySelector('.settings-column-right form[action*="/settings"]');
    if (!form) return;
    const hidden = form.querySelector('#settings-next-hash');
    form.addEventListener('submit', function(){
      let hash = location.hash || '';
      // –µ—Å–ª–∏ hash –ø—É—Å—Ç, –ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Å—Å—ã–ª–∫—É pills
      if (!hash){
        const active = document.querySelector('.nav.nav-pills .nav-link.active');
        if (active && active.getAttribute('href')) hash = active.getAttribute('href');
      }
      if (!hash) hash = '#panel';
      if (hidden) hidden.value = hash;
    });
  })();
</script>

<script>
  document.addEventListener('click', function (e) {
    const btn = e.target.closest('.plan-edit-toggle');
    if (!btn) return;
    const targetSel = btn.getAttribute('data-target');
    if (!targetSel) return;
    const panel = document.querySelector(targetSel);
    if (!panel) return;

    const hostSection = btn.closest('.plans-section');
    if (hostSection) {
      // Close other open panels in this host section
      hostSection.querySelectorAll('.plan-edit.collapse.show').forEach(other => {
        if (other !== panel) {
          const otherBtn = hostSection.querySelector(`.plan-edit-toggle[data-target="#${other.id}"]`);
          if (otherBtn) otherBtn.setAttribute('aria-expanded', 'false');
          other.style.maxHeight = other.scrollHeight + 'px';
          requestAnimationFrame(() => {
            other.style.maxHeight = '0px';
            setTimeout(() => { other.classList.remove('show'); }, 220);
          });
        }
      });
    }

    const isOpen = panel.classList.contains('show');
    if (!isOpen) {
      // Open with auto-height
      panel.classList.add('show');
      panel.style.maxHeight = panel.scrollHeight + 'px';
      setTimeout(() => { panel.style.maxHeight = 'none'; }, 230);
      btn.setAttribute('aria-expanded', 'true');
    } else {
      // Close with height animation
      panel.style.maxHeight = panel.scrollHeight + 'px';
      requestAnimationFrame(() => {
        panel.style.maxHeight = '0px';
        setTimeout(() => { panel.classList.remove('show'); }, 220);
      });
      btn.setAttribute('aria-expanded', 'false');
    }
  });
</script>

{% endblock %}
